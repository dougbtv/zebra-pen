# zebra-pen

A suite of playbooks and roles to create a demo router VNF.

## Goal

Have box `CentOS A` ping box `CentOS B` via containerized routers running on Router A & Router B

```
CentOS A -> Router A -> Router B -> CentoOS B
```

## How-to

There's two phases here, I would've done this in one shot, but would require some sorcery with dynamic inventories, and to be expedient, I've left it to the user to create a second inventory of hosts.

* Phase 1: Configures the virtual machine host and spins up 4 VMs (as above in goal)
* Phase 2: You make a new inventory and then configure the virtual machines

If you are feeling ambitious, make 4 bare metal machines, and then just use Phase 2.

### Phase 1: Virthost setup

You'll first need a CentOS 7.3 (with the latest packages) installed on a machine, this machine will need to have virtualization capabilities. This is our virtualization host, which we refer to as virt-host.

Secodarily, you need [ansible installed](http://docs.ansible.com/ansible/intro_installation.html) somewhere, this can also be the virt-host proper if you please. Also, give yourself SSH keys as root to this machine.

Modify the `inventory/virthost.inventory` file to point to the proper IP address for this machine.

There are additional parameters which are flat across VMs, such as amount of RAM and how many CPUs to use, which you can configure if you'd like in the `./vars/all.yml` variables file.

Then you can clone this repo and run the playbook to setup the virt-host with:

```
ansible-playbook -i inventory/virthost.inventory virt-host-setup.yml
```

Take specific note of the section where you get the IP addresses of the virtual machines, we'll use those in phase 2 for provisioning the virtual machines.

```

```

Assuming the playbook has run successfully, you'll see that there's a series of VMs running on this machine, now.

```
$ virsh list
```

You can of course destroy them if you need to with `virsh destroy $name`

To access these, you use the SSH key as generated by this playbook, `/root/.ssh/id_vm_rsa`

### Phase 2: Provisioning virtual machines



## Notes from development

Using this article as a [basis for spinning up virtual machines](http://giovannitorres.me/create-a-linux-lab-on-kvm-using-cloud-images.html) from a centos generic cloud image. The meat of the article is [this gist](https://gist.github.com/giovtorres/0049cec554179d96e0a8329930a6d724).